# Lab 13: Kubernetes StatefulSet

## Task 1

```bash
egor@egor-Swift-SF314-43:~/InnoSubjects/F23/DevOps/devops-core-course-labs/k8s$ helm  install --dry-run --debug helm-python-app ./helm-python-app
install.go:214: [debug] Original chart version: ""
install.go:231: [debug] CHART PATH: /home/egor/InnoSubjects/F23/DevOps/devops-core-course-labs/k8s/helm-python-app

NAME: helm-python-app
LAST DEPLOYED: Tue Nov 28 00:45:53 2023
NAMESPACE: default
STATUS: pending-install
REVISION: 1
USER-SUPPLIED VALUES:
{}

COMPUTED VALUES:
affinity: {}
autoscaling:
  enabled: false
  maxReplicas: 100
  minReplicas: 1
  targetCPUUtilizationPercentage: 80
fullnameOverride: ""
image:
  pullPolicy: Always
  repository: wildqueue/devops-hw
  tag: tagname
imagePullSecrets: []
ingress:
  annotations: {}
  className: ""
  enabled: false
  hosts:
  - host: chart-example.local
    paths:
    - path: /
      pathType: ImplementationSpecific
  tls: []
library-chart:
  global: {}
mysecret:
  key1: secretK
  key2: secondK
  name1: my-secret
  name2: my-secret
nameOverride: ""
nodeSelector: {}
podAnnotations:
  vault.hashicorp.com/agent-init-first: "true"
  vault.hashicorp.com/agent-inject: "true"
  vault.hashicorp.com/agent-inject-secret-database-config.txt: internal/data/database/config
  vault.hashicorp.com/agent-inject-status: update
  vault.hashicorp.com/agent-inject-template-database-config.txt: |
    {{- with secret "internal/data/database/config" -}}
    My Secrets = {{ .Data.data.username }}:{{ .Data.data.password }}
    {{- end -}}
  vault.hashicorp.com/agent-pre-populate: "false"
  vault.hashicorp.com/role: internal-app
podLabels: {}
podSecurityContext: {}
pvc:
  create: true
  name: visits-web
  size: 2Mi
  storageClass: standard
replicaCount: 2
resources:
  limits:
    cpu: 200m
    memory: 256Mi
  requests:
    cpu: 100m
    memory: 128Mi
securityContext:
  runAsNonRoot: false
  runAsUser: 0
service:
  port: 8008
  type: LoadBalancer
serviceAccount:
  annotations: {}
  automount: true
  create: false
  name: internal-app
tolerations: []
volumeMounts:
- mountPath: /app/volume
  name: visits-web
volumes:
- configMap:
    name: visits-configmap
  name: visits-python

HOOKS:
---
# Source: helm-python-app/templates/postinstall-hook.yaml
apiVersion: v1
kind: Pod
metadata:
   name: postinstall-hook
   annotations:
       "helm.sh/hook": "post-install"
       "helm.sh/hook-delete-policy": hook-succeeded,hook-failed
spec:
  containers:
  - name: post-install-container
    image: busybox
    imagePullPolicy: Always
    command: ['sh', '-c', 'echo The post-install hook is running && sleep 1' ]
  restartPolicy: Never
  terminationGracePeriodSeconds: 0
---
# Source: helm-python-app/templates/preinstall-hook.yaml
apiVersion: v1
kind: Pod
metadata:
   name: preinstall-hook
   annotations:
       "helm.sh/hook": "pre-install"
       "helm.sh/hook-delete-policy": hook-succeeded,hook-failed
spec:
  containers:
  - name: pre-install-container
    image: busybox
    imagePullPolicy: IfNotPresent
    command: ['sh', '-c', 'echo The pre-install hook is running && sleep 1' ]
  restartPolicy: Never
  terminationGracePeriodSeconds: 0
---
# Source: helm-python-app/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "helm-python-app-test-connection"
  labels:
    helm.sh/chart: helm-python-app-0.1.0
    app.kubernetes.io/name: helm-python-app
    app.kubernetes.io/instance: helm-python-app
    app.kubernetes.io/version: "1.16.0"
    app.kubernetes.io/managed-by: Helm
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['helm-python-app:8008']
  restartPolicy: Never
MANIFEST:
---
# Source: helm-python-app/templates/secrets.yaml
apiVersion: v1
data:
  secondK: c2Vjb25kCg==
  secretK: c2VjcmV0IHBhc3N3b3Jk
kind: Secret
metadata:
  annotations:
    meta.helm.sh/release-name: python-helm-app
    meta.helm.sh/release-namespace: default
  creationTimestamp: "2023-11-13T21:36:42Z"
  labels:
    app.kubernetes.io/managed-by: Helm
  name: my-secret
  namespace: default
  resourceVersion: "48810"
  uid: 6f5c4dec-115c-4607-904f-c659116b5c87
type: Opaque
---
# Source: helm-python-app/templates/configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: config-configmap
data:
  config.json: |-
    {"key": "secret"}
---
# Source: helm-python-app/templates/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: helm-python-app
  labels:
    helm.sh/chart: helm-python-app-0.1.0
    app.kubernetes.io/name: helm-python-app
    app.kubernetes.io/instance: helm-python-app
    app.kubernetes.io/version: "1.16.0"
    app.kubernetes.io/managed-by: Helm
spec:
  type: LoadBalancer
  ports:
    - port: 8008
      targetPort: http
      protocol: TCP
      name: http
  selector:
    app.kubernetes.io/name: helm-python-app
    app.kubernetes.io/instance: helm-python-app
---
# Source: helm-python-app/templates/statefulset.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: helm-python-app
  labels:
    helm.sh/chart: helm-python-app-0.1.0
    app.kubernetes.io/name: helm-python-app
    app.kubernetes.io/instance: helm-python-app
    app.kubernetes.io/version: "1.16.0"
    app.kubernetes.io/managed-by: Helm
spec:
  podManagementPolicy: Parallel
  replicas: 2
  selector:
    matchLabels:
      app.kubernetes.io/name: helm-python-app
      app.kubernetes.io/instance: helm-python-app
  template:
    metadata:
      annotations:
        vault.hashicorp.com/agent-init-first: "true"
        vault.hashicorp.com/agent-inject: "true"
        vault.hashicorp.com/agent-inject-secret-database-config.txt: internal/data/database/config
        vault.hashicorp.com/agent-inject-status: update
        vault.hashicorp.com/agent-inject-template-database-config.txt: |
          {{- with secret "internal/data/database/config" -}}
          My Secrets = {{ .Data.data.username }}:{{ .Data.data.password }}
          {{- end -}}
        vault.hashicorp.com/agent-pre-populate: "false"
        vault.hashicorp.com/role: internal-app
      labels:
        helm.sh/chart: helm-python-app-0.1.0
        app.kubernetes.io/name: helm-python-app
        app.kubernetes.io/instance: helm-python-app
        app.kubernetes.io/version: "1.16.0"
        app.kubernetes.io/managed-by: Helm
    spec:
      serviceAccountName: internal-app
      securityContext:
        {}
      containers:
        - name: helm-python-app
          securityContext:
            runAsNonRoot: false
            runAsUser: 0
          image: "wildqueue/devops-hw:tagname"
          imagePullPolicy: Always
          ports:
            - name: http
              containerPort: 8008
              protocol: TCP
          env:
            
            - name: "my-secret"
              valueFrom:
                secretKeyRef:
                  name: my-secret
                  key: secretK
            - name: "my-secret-two"
              valueFrom:
                secretKeyRef:
                  name: my-secret
                  key: secondK
          # envFrom:
          #   - configMapRef:
          #       name: my-env-configmap

          # livenessProbe:
          #   httpGet:
          #     path: /
          #     port: http
          # readinessProbe:
          #   httpGet:
          #     path: /
          #     port: http
          resources:
            limits:
              cpu: 200m
              memory: 256Mi
            requests:
              cpu: 100m
              memory: 128Mi
          volumeMounts:
            - mountPath: /app/volume
              name: visits-web
      volumes:
        - configMap:
            name: visits-configmap
          name: visits-python
  volumeClaimTemplates:
  - metadata:
      name: visits-web
    spec:
      accessModes: [ "ReadWriteOnce" ]
      storageClassName: standard
      resources:
        requests:
          storage: 2Mi
---
# Source: helm-python-app/templates/env-config.yaml
# apiVersion: v1
# kind: ConfigMap
# metadata:
#   name: my-env-configmap
# data:
#   MY_SECRET: "DEVOPS_LAB"

NOTES:
1. Get the application URL by running these commands:
     NOTE: It may take a few minutes for the LoadBalancer IP to be available.
           You can watch the status of by running 'kubectl get --namespace default svc -w helm-python-app'
  export SERVICE_IP=$(kubectl get svc --namespace default helm-python-app --template "{{ range (index .status.loadBalancer.ingress 0) }}{{.}}{{ end }}")
  echo http://$SERVICE_IP:8008
```


```bash
egor@egor-Swift-SF314-43:~/InnoSubjects/F23/DevOps/devops-core-course-labs/k8s$ helm  install helm-python-app ./helm-python-app
NAME: helm-python-app
LAST DEPLOYED: Tue Nov 28 00:48:29 2023
NAMESPACE: default
STATUS: deployed
REVISION: 1
NOTES:
1. Get the application URL by running these commands:
     NOTE: It may take a few minutes for the LoadBalancer IP to be available.
           You can watch the status of by running 'kubectl get --namespace default svc -w helm-python-app'
  export SERVICE_IP=$(kubectl get svc --namespace default helm-python-app --template "{{ range (index .status.loadBalancer.ingress 0) }}{{.}}{{ end }}")
  echo http://$SERVICE_IP:8008
```

## Task 2

```bash
egor@egor-Swift-SF314-43:~/InnoSubjects/F23/DevOps/devops-core-course-labs/k8s$ kubectl get po,sts,svc,pvc
NAME                                        READY   STATUS    RESTARTS       AGE
pod/helm-python-app-0                       2/2     Running   0              39s
pod/helm-python-app-1                       2/2     Running   0              39s
pod/vault-0                                 1/1     Running   2 (6d4h ago)   13d
pod/vault-agent-injector-5cd8b87c6c-nbhwg   1/1     Running   2 (6d4h ago)   13d

NAME                               READY   AGE
statefulset.apps/helm-python-app   2/2     39s
statefulset.apps/vault             1/1     13d

NAME                               TYPE           CLUSTER-IP       EXTERNAL-IP   PORT(S)             AGE
service/helm-python-app            LoadBalancer   10.110.100.148   <pending>     8008:32646/TCP      39s
service/kubernetes                 ClusterIP      10.96.0.1        <none>        443/TCP             28d
service/vault                      ClusterIP      10.104.51.46     <none>        8200/TCP,8201/TCP   13d
service/vault-agent-injector-svc   ClusterIP      10.104.116.78    <none>        443/TCP             13d
service/vault-internal             ClusterIP      None             <none>        8200/TCP,8201/TCP   13d

NAME                                                 STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE
persistentvolumeclaim/visits-web-helm-python-app-0   Bound    pvc-52a9a4c5-e8d2-4455-ac5c-78716a68c579   2Mi        RWO            standard       40m
persistentvolumeclaim/visits-web-helm-python-app-1   Bound    pvc-583a61e0-80c4-4578-8519-fdc723aa6a38   2Mi        RWO            standard       40m
```

```bash
egor@egor-Swift-SF314-43:~/InnoSubjects/F23/DevOps/devops-core-course-labs/k8s$ minikube service helm-python-app
|-----------|-----------------|-------------|---------------------------|
| NAMESPACE |      NAME       | TARGET PORT |            URL            |
|-----------|-----------------|-------------|---------------------------|
| default   | helm-python-app | http/8008   | http://192.168.49.2:32646 |
|-----------|-----------------|-------------|---------------------------|
🎉  Opening service default/helm-python-app in default browser...
/snap/core20/current/lib/x86_64-linux-gnu/libstdc++.so.6: version `GLIBCXX_3.4.29' not found (required by /lib/x86_64-linux-gnu/libproxy.so.1)
Failed to load module: /home/egor/snap/code/common/.cache/gio-modules/libgiolibproxy.so
```


```bash
egor@egor-Swift-SF314-43:~/InnoSubjects/F23/DevOps/devops-core-course-labs/k8s$ kubectl exec pod/helm-python-app-0 -it /bin/sh
kubectl exec [POD] [COMMAND] is DEPRECATED and will be removed in a future version. Use kubectl exec [POD] -- [COMMAND] instead.
Defaulted container "helm-python-app" out of: helm-python-app, vault-agent
# cat volume/visits
15.0
# exit
egor@egor-Swift-SF314-43:~/InnoSubjects/F23/DevOps/devops-core-course-labs/k8s$ kubectl exec pod/helm-python-app-1 -it /bin/sh
kubectl exec [POD] [COMMAND] is DEPRECATED and will be removed in a future version. Use kubectl exec [POD] -- [COMMAND] instead.
Defaulted container "helm-python-app" out of: helm-python-app, vault-agent
# cat volume/visits
21.0
# exit
```

The difference in the number of visits for a web-application in two Kubernetes pods can be due to several factors, such as differences in the load balancing algorithm, differences in the resources allocated to each pod, and differences in the network latency.

### The pods were set up to work in parallel from the beginning.

Ordering guarantees are unnecessary for my application because it does not require a specific order of events or data to be accurate. The current Moscow time is constantly changing and updating in real-time, so there is no need for the app to ensure a specific order of events to display the correct time. Similarly, the count of visits number is a simple operation that does not require any complex calculations or a specific order of events to be accurate. Therefore, ordering guarantees are not relevant or necessary for this type of app. 

## Bonuses


```bash
egor@egor-Swift-SF314-43:~/InnoSubjects/F23/DevOps/devops-core-course-labs/k8s$ helm  install --dry-run --debug helm-golang-app ./helm-golang-app
install.go:214: [debug] Original chart version: ""
install.go:231: [debug] CHART PATH: /home/egor/InnoSubjects/F23/DevOps/devops-core-course-labs/k8s/helm-golang-app

NAME: helm-golang-app
LAST DEPLOYED: Tue Nov 28 01:05:00 2023
NAMESPACE: default
STATUS: pending-install
REVISION: 1
USER-SUPPLIED VALUES:
{}

COMPUTED VALUES:
affinity: {}
autoscaling:
  enabled: false
  maxReplicas: 100
  minReplicas: 1
  targetCPUUtilizationPercentage: 80
fullnameOverride: ""
image:
  pullPolicy: Always
  repository: wildqueue/devops-hw-golang
  tag: tagname
imagePullSecrets: []
ingress:
  annotations: {}
  className: ""
  enabled: false
  hosts:
  - host: chart-example.local
    paths:
    - path: /
      pathType: ImplementationSpecific
  tls: []
library-chart:
  global: {}
mysecret:
  key1: secretK
  key2: secondK
  name1: my-secret
  name2: my-secret
nameOverride: ""
nodeSelector: {}
podAnnotations: {}
podLabels: {}
podSecurityContext: {}
pvc:
  create: true
  name: visits-web
  size: 2Mi
  storageClass: standard
replicaCount: 2
resources: {}
securityContext: {}
service:
  port: 8008
  type: LoadBalancer
serviceAccount:
  annotations: {}
  automount: true
  create: false
  name: ""
tolerations: []
volumeMounts:
- mountPath: /app/volume
  name: visits-web
volumes: []

HOOKS:
---
# Source: helm-golang-app/templates/postinstall-hook.yaml
apiVersion: v1
kind: Pod
metadata:
   name: postinstall-hook
   annotations:
       "helm.sh/hook": "post-install"
       "helm.sh/hook-delete-policy": hook-succeeded,hook-failed
spec:
  containers:
  - name: post-install-container
    image: busybox
    imagePullPolicy: Always
    command: ['sh', '-c', 'echo The post-install hook is running && sleep 1' ]
  restartPolicy: Never
  terminationGracePeriodSeconds: 0
---
# Source: helm-golang-app/templates/preinstall-hook.yaml
apiVersion: v1
kind: Pod
metadata:
   name: preinstall-hook
   annotations:
       "helm.sh/hook": "pre-install"
       "helm.sh/hook-delete-policy": hook-succeeded,hook-failed
spec:
  containers:
  - name: pre-install-container
    image: busybox
    imagePullPolicy: IfNotPresent
    command: ['sh', '-c', 'echo The pre-install hook is running && sleep 1' ]
  restartPolicy: Never
  terminationGracePeriodSeconds: 0
---
# Source: helm-golang-app/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "helm-golang-app-test-connection"
  labels:
    helm.sh/chart: helm-golang-app-0.1.0
    app.kubernetes.io/name: helm-golang-app
    app.kubernetes.io/instance: helm-golang-app
    app.kubernetes.io/version: "1.16.0"
    app.kubernetes.io/managed-by: Helm
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['helm-golang-app:8008']
  restartPolicy: Never
MANIFEST:
---
# Source: helm-golang-app/templates/secrets.yaml
apiVersion: v1
data:
  secondK: c2Vjb25kCg==
  secretK: c2VjcmV0IHBhc3N3b3Jk
kind: Secret
metadata:
  annotations:
    meta.helm.sh/release-name: golang-helm-app
    meta.helm.sh/release-namespace: default
  creationTimestamp: "2023-11-13T22:17:31Z"
  labels:
    app.kubernetes.io/managed-by: Helm
  name: my-secret
  namespace: default
  resourceVersion: "57180"
  uid: 3ab31bdd-c315-4607-341f-c673116d5a97
type: Opaque
---
# Source: helm-golang-app/templates/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: helm-golang-app
  labels:
    helm.sh/chart: helm-golang-app-0.1.0
    app.kubernetes.io/name: helm-golang-app
    app.kubernetes.io/instance: helm-golang-app
    app.kubernetes.io/version: "1.16.0"
    app.kubernetes.io/managed-by: Helm
spec:
  type: LoadBalancer
  ports:
    - port: 8008
      targetPort: http
      protocol: TCP
      name: http
  selector:
    app.kubernetes.io/name: helm-golang-app
    app.kubernetes.io/instance: helm-golang-app
---
# Source: helm-golang-app/templates/statefulset.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: helm-golang-app
  labels:
    helm.sh/chart: helm-golang-app-0.1.0
    app.kubernetes.io/name: helm-golang-app
    app.kubernetes.io/instance: helm-golang-app
    app.kubernetes.io/version: "1.16.0"
    app.kubernetes.io/managed-by: Helm
spec:
  podManagementPolicy: Parallel
  replicas: 2
  selector:
    matchLabels:
      app.kubernetes.io/name: helm-golang-app
      app.kubernetes.io/instance: helm-golang-app
  template:
    metadata:
      labels:
        helm.sh/chart: helm-golang-app-0.1.0
        app.kubernetes.io/name: helm-golang-app
        app.kubernetes.io/instance: helm-golang-app
        app.kubernetes.io/version: "1.16.0"
        app.kubernetes.io/managed-by: Helm
    spec:
      serviceAccountName: default
      securityContext:
        {}
      containers:
        - name: helm-golang-app
          securityContext:
            {}
          image: "wildqueue/devops-hw-golang:tagname"
          imagePullPolicy: Always
          ports:
            - name: http
              containerPort: 8008
              protocol: TCP
          env:
            
            - name: "my-secret"
              valueFrom:
                secretKeyRef:
                  name: my-secret
                  key: secretK
            - name: "my-secret-two"
              valueFrom:
                secretKeyRef:
                  name: my-secret
                  key: secondK
          # livenessProbe:
          #   httpGet:
          #     path: /
          #     port: http
          # readinessProbe:
          #   httpGet:
          #     path: /
          #     port: http
          resources:
            {}
          volumeMounts:
            - mountPath: /app/volume
              name: visits-web
  volumeClaimTemplates:
  - metadata:
      name: visits-web
    spec:
      accessModes: [ "ReadWriteOnce" ]
      storageClassName: standard
      resources:
        requests:
          storage: 2Mi

NOTES:
1. Get the application URL by running these commands:
     NOTE: It may take a few minutes for the LoadBalancer IP to be available.
           You can watch the status of by running 'kubectl get --namespace default svc -w helm-golang-app'
  export SERVICE_IP=$(kubectl get svc --namespace default helm-golang-app --template "{{ range (index .status.loadBalancer.ingress 0) }}{{.}}{{ end }}")
  echo http://$SERVICE_IP:8008
  ```


```bash
egor@egor-Swift-SF314-43:~/InnoSubjects/F23/DevOps/devops-core-course-labs/k8s$ helm  install helm-golang-app ./helm-golang-app
NAME: helm-golang-app
LAST DEPLOYED: Tue Nov 28 01:05:47 2023
NAMESPACE: default
STATUS: deployed
REVISION: 1
NOTES:
1. Get the application URL by running these commands:
     NOTE: It may take a few minutes for the LoadBalancer IP to be available.
           You can watch the status of by running 'kubectl get --namespace default svc -w helm-golang-app'
  export SERVICE_IP=$(kubectl get svc --namespace default helm-golang-app --template "{{ range (index .status.loadBalancer.ingress 0) }}{{.}}{{ end }}")
  echo http://$SERVICE_IP:8008
egor@egor-Swift-SF314-43:~/InnoSubjects/F23/DevOps/devops-core-course-labs/k8s$ kubectl get po,sts,svc,pvc
NAME                                        READY   STATUS    RESTARTS       AGE
pod/helm-golang-app-0                       1/1     Running   0              16s
pod/helm-golang-app-1                       1/1     Running   0              16s
pod/vault-0                                 1/1     Running   2 (6d5h ago)   13d
pod/vault-agent-injector-5cd8b87c6c-nbhwg   1/1     Running   2 (6d5h ago)   13d

NAME                               READY   AGE
statefulset.apps/helm-golang-app   2/2     16s
statefulset.apps/vault             1/1     13d

NAME                               TYPE           CLUSTER-IP       EXTERNAL-IP   PORT(S)             AGE
service/helm-golang-app            LoadBalancer   10.104.221.210   <pending>     8008:32021/TCP      16s
service/kubernetes                 ClusterIP      10.96.0.1        <none>        443/TCP             28d
service/vault                      ClusterIP      10.104.51.46     <none>        8200/TCP,8201/TCP   13d
service/vault-agent-injector-svc   ClusterIP      10.104.116.78    <none>        443/TCP             13d
service/vault-internal             ClusterIP      None             <none>        8200/TCP,8201/TCP   13d

NAME                                                 STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE
persistentvolumeclaim/visits-web-helm-golang-app-0   Bound    pvc-459fc0fe-9070-40fe-9538-ae5a1ac5c34f   2Mi        RWO            standard       16s
persistentvolumeclaim/visits-web-helm-golang-app-1   Bound    pvc-0cd1fed8-a61c-4bf4-b9db-5614683e682d   2Mi        RWO            standard       16s
```

```bash
egor@egor-Swift-SF314-43:~/InnoSubjects/F23/DevOps/devops-core-course-labs/k8s$ minikube service helm-golang-app
|-----------|-----------------|-------------|---------------------------|
| NAMESPACE |      NAME       | TARGET PORT |            URL            |
|-----------|-----------------|-------------|---------------------------|
| default   | helm-golang-app | http/8008   | http://192.168.49.2:32021 |
|-----------|-----------------|-------------|---------------------------|
🎉  Opening service default/helm-golang-app in default browser...
/snap/core20/current/lib/x86_64-linux-gnu/libstdc++.so.6: version `GLIBCXX_3.4.29' not found (required by /lib/x86_64-linux-gnu/libproxy.so.1)
Failed to load module: /home/egor/snap/code/common/.cache/gio-modules/libgiolibproxy.so
```

```bash
egor@egor-Swift-SF314-43:~/InnoSubjects/F23/DevOps/devops-core-course-labs/k8s$ kubectl exec pod/helm-golang-app-0 -it /bin/sh
kubectl exec [POD] [COMMAND] is DEPRECATED and will be removed in a future version. Use kubectl exec [POD] -- [COMMAND] instead.
# ls
go.mod  go.sum  main.go  volume
# cat volume/visits
25.000000
# exit
egor@egor-Swift-SF314-43:~/InnoSubjects/F23/DevOps/devops-core-course-labs/k8s$ kubectl exec pod/helm-golang-app-1 -it /bin/sh
kubectl exec [POD] [COMMAND] is DEPRECATED and will be removed in a future version. Use kubectl exec [POD] -- [COMMAND] instead.
# cat volume/visits
24.000000
# exit
```


### Difference in update strategies


StatefulSets in Kubernetes are used to manage stateful applications that require stable network identifiers and persistent storage. When it comes to updating these StatefulSets, there are two main strategies - Rolling Update and Blue/Green Deployment.


Rolling Update is the default update strategy for StatefulSets. In this strategy, the update process is carried out one pod at a time, ensuring that there is always at least one replica of the old version running while the new version is being deployed. This ensures that the application remains available throughout the update process. Once all the pods have been updated, the StatefulSet is considered updated.


On the other hand, Blue/Green Deployment is a more advanced update strategy for StatefulSets. In this strategy, a completely new set of pods are created with the updated version of the application. Once these new pods are ready, traffic is switched over to them while the old pods are terminated. This approach ensures that there is no downtime during the update process, as the new version of the application is fully deployed before any traffic is switched over to it.


Both of these update strategies have their own advantages and disadvantages. Rolling Update is a simpler approach and can be used for most StatefulSets, while Blue/Green Deployment is more complex but provides zero-downtime updates for critical applications.